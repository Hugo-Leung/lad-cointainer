Bootstrap: docker
From: almalinux:9 

%setup
mkdir ${APPTAINER_ROOTFS}/w
mkdir ${APPTAINER_ROOTFS}/volatile
mkdir ${APPTAINER_ROOTFS}/cache
wget https://pki.jlab.org/JLabCA.crt -O  ${APPTAINER_ROOTFS}/etc/pki/ca-trust/source/anchors/JLabCA.crt


%files 
	./dnf.sh /dnf.sh
	./packages /packages
	./root.sh /root.sh
	./hcana.sh /hcana.sh
	./ladlib.sh /ladlib.sh
%post
	update-ca-trust
	bash /dnf.sh
	bash /root.sh
	bash /hcana.sh
	bash /ladlib.sh
	NOW=`date`
	echo "export NOW=\"${NOW}\"" >> $APPTAINER_ENVIRONMENT
	
	rm /dnf.sh /root.sh /hcana.sh /ladlib.sh /packages

%environment
	export ROOTSYS=/opt/root
	export PATH=$ROOTSYS/bin:$PATH
	export PYTHONPATH=$ROOTSYS/lib:$PYTHONPATH
	export CLING_STANDARD_PCH=none

	export PATH=/opt/hcana/bin:$PATH
	export LD_LIBRARY_PATH=/opt/LADlib/lib64/:$LD_LIBRARY_PATH
	export ROOT_INCLUDE_PATH=/opt/LADlib/include:/opt/hcana/include:$ROOT_INCLUDE_PATH
%runscript
	hcana "$@"
